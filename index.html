<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Welcome Home</title>
<style>
:root{
  --ink:#f6f1e8;
  --muted:rgba(246,241,232,.78);
  --muted2:rgba(246,241,232,.60);

  /* wood */
  --wood1:#6b3f25;
  --wood2:#4d2b18;
  --wood3:#2f1a10;
  --brass:#d2b15e;
  --brass2:#b08a2e;

  --shadow: 0 18px 60px rgba(0,0,0,.55);
  --r:22px;
}

*{box-sizing:border-box}
body{
  margin:0; min-height:100vh;
  display:flex; align-items:center; justify-content:center;
  background:
    radial-gradient(1200px 900px at 50% 10%, rgba(200,170,120,.18) 0%, rgba(10,15,26,1) 55%, rgba(0,0,0,1) 100%),
    linear-gradient(180deg, #070a11, #000);
  color:var(--ink);
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "PingFang SC", "Noto Sans CJK SC", sans-serif;
  padding:22px;
}

/* container */
.wrap{width:min(560px, 100%);}

/* the DOOR */
.doorCard{
  position:relative;
  border-radius:var(--r);
  overflow:hidden;
  box-shadow: var(--shadow);
  border:1px solid rgba(255,255,255,.08);
  background:
    /* vignette */
    radial-gradient(900px 600px at 50% 25%, rgba(0,0,0,.0) 0%, rgba(0,0,0,.55) 70%, rgba(0,0,0,.75) 100%),
    /* wood grain fake */
    repeating-linear-gradient(
      90deg,
      rgba(255,255,255,.04) 0px,
      rgba(255,255,255,.00) 8px,
      rgba(0,0,0,.08) 18px
    ),
    linear-gradient(135deg, var(--wood1), var(--wood2));
}

/* door panels */
.doorCard::before{
  content:"";
  position:absolute; inset:14px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.10);
  box-shadow: inset 0 0 0 2px rgba(0,0,0,.22);
  background:
    radial-gradient(500px 220px at 50% 0%, rgba(255,255,255,.08), rgba(255,255,255,0) 60%),
    linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.0));
  pointer-events:none;
}

/* door edge frame */
.doorFrame{
  position:absolute; inset:0;
  border-radius:var(--r);
  box-shadow: inset 0 0 0 10px rgba(0,0,0,.18);
  pointer-events:none;
}

/* top small plaque */
.plaque{
  position:relative;
  margin:22px 22px 0 22px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
/* cute nameplate */
.nameplate{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:2px;
  padding:10px 12px;
  border-radius:14px;
  background: linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.36));
  border:1px solid rgba(255,255,255,.12);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
}
.plateTop{
  font-weight:1000;
  letter-spacing:.6px;
  color: rgba(246,241,232,.92);
  font-size:14px;
}
.plateSub{
  font-size:11px;
  letter-spacing:.8px;
  text-transform:uppercase;
  color: rgba(246,241,232,.62);
}

/* cat paw door knocker */
.knocker{
  position:absolute;
  left:28px;
  top:150px;
  width:92px;
  height:92px;
  border-radius:22px;
  background:
    radial-gradient(120px 80px at 40% 20%, rgba(255,255,255,.10), rgba(255,255,255,0) 55%),
    linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.32));
  border:1px solid rgba(255,255,255,.12);
  box-shadow: 0 18px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.08);
  cursor:pointer;
  display:grid;
  place-items:center;
  color:transparent;
  z-index: 5;
}
@media (max-width:560px){
  .knocker{ left:18px; top:84px; width:84px; height:84px; }
}

.paw{
  position:relative;
  width:44px;
  height:44px;
}
.paw .toe{
  position:absolute;
  width:12px; height:12px;
  border-radius:999px;
  background: linear-gradient(180deg, rgba(210,177,94,.98), rgba(176,138,46,.98));
  box-shadow: 0 10px 16px rgba(0,0,0,.22);
  opacity:.95;
}
.paw .t1{left:2px; top:0px}
.paw .t2{left:16px; top:-4px}
.paw .t3{left:30px; top:0px}
.paw .t4{left:14px; top:8px; opacity:.88; transform:scale(.9)}
.paw .pad{
  position:absolute;
  left:8px; top:16px;
  width:28px; height:24px;
  border-radius: 16px 16px 18px 18px;
  background: linear-gradient(180deg, rgba(210,177,94,.98), rgba(176,138,46,.98));
  box-shadow: 0 12px 18px rgba(0,0,0,.25);
}

.ring{
  position:absolute;
  width:36px; height:36px;
  border-radius:999px;
  border:4px solid rgba(210,177,94,.92);
  box-shadow: 0 14px 22px rgba(0,0,0,.25);
  transform: translateY(18px);
  opacity:.95;
}

.knocker:active{ transform: translateY(1px); }

/* dingdong bubble */
.ding{
  position:absolute;
  left:132px;
  top:104px;
  padding:8px 10px;
  border-radius:999px;
  background: rgba(0,0,0,.28);
  border:1px solid rgba(255,255,255,.12);
  color: rgba(246,241,232,.86);
  font-size:13px;
  opacity:0;
  transform: translateY(6px);
  pointer-events:none;
  transition: all .22s ease;
}
.ding.show{
  opacity:1;
  transform: translateY(0);
}

/* knock animation on the knocker + slight door glow */
@keyframes knock{
  0%{transform: translateY(0) rotate(0deg)}
  25%{transform: translateY(2px) rotate(-4deg)}
  55%{transform: translateY(0) rotate(3deg)}
  100%{transform: translateY(0) rotate(0deg)}
}
.knock{ animation: knock .28s ease; }

.tag{
  display:inline-flex; align-items:center; gap:10px;
  padding:10px 12px;
  border-radius:999px;
  background: rgba(0,0,0,.25);
  border:1px solid rgba(255,255,255,.10);
  color:var(--muted);
  font-size:13px;
}
.dot{
  width:9px; height:9px; border-radius:50%;
  background: rgba(210,177,94,.95);
  box-shadow: 0 0 18px rgba(210,177,94,.45);
}

/* main content area */
.inner{
  position: relative;
  z-index: 2;
  padding:16px 22px 22px 22px;
  display:grid;
  grid-template-columns: 1.2fr .95fr;
  gap:18px;
  align-items:start;
}

@media (max-width:560px){
  .inner{grid-template-columns:1fr; gap:14px;}
}

/* left message */
h1{
  margin:8px 0 6px 0;
  font-size:20px;
  letter-spacing:.2px;
}
.sub{
  margin:0 0 12px 0;
  color:var(--muted);
  font-size:14px;
  line-height:1.65;
}

/* keypad panel */
.lock{
  position:relative;
  border-radius:18px;
  padding:14px;
  background:
    radial-gradient(400px 200px at 50% 0%, rgba(255,255,255,.08), rgba(255,255,255,0) 60%),
    linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.38));
  border:1px solid rgba(255,255,255,.12);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.10),
    0 14px 26px rgba(0,0,0,.35);
}

/* brass strip like a real keypad */
.lockHeader{
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:10px;
}
.lockTitle{
  font-size:12px; letter-spacing:.6px;
  color:rgba(246,241,232,.70);
  text-transform:uppercase;
}
.brass{
  height:10px; width:42%;
  border-radius:999px;
  background: linear-gradient(90deg, var(--brass), var(--brass2));
  opacity:.95;
  box-shadow: 0 8px 18px rgba(210,177,94,.18);
}

/* input display like keypad screen */
.displayRow{display:flex; gap:10px; align-items:center;}
input{
  width:100%;
  background: rgba(0,0,0,.38);
  color: var(--ink);
  border:1px solid rgba(255,255,255,.12);
  border-radius:14px;
  padding:12px 12px;
  outline:none;
  font-size:16px;
}
input::placeholder{color:rgba(246,241,232,.50)}
input:focus{
  border-color: rgba(210,177,94,.70);
  box-shadow: 0 0 0 4px rgba(210,177,94,.16);
}

button{
  border:none;
  cursor:pointer;
  border-radius:14px;
  padding:12px 14px;
  font-weight:900;
  font-size:15px;
  white-space:nowrap;
}
.primary{
  color:#1b1208;
  background: linear-gradient(135deg, rgba(210,177,94,.98), rgba(176,138,46,.98));
  box-shadow: 0 12px 22px rgba(0,0,0,.25);
}
.ghost{
  background: rgba(0,0,0,.18);
  color: rgba(246,241,232,.78);
  border:1px solid rgba(255,255,255,.12);
}

/* keypad buttons */
.keypad{
  margin-top:10px;
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:10px;
}
.key{
  padding:12px 0;
  border-radius:14px;
  background: rgba(0,0,0,.26);
  border:1px solid rgba(255,255,255,.10);
  color: rgba(246,241,232,.92);
  font-weight:900;
  font-size:16px;
}
.key:active{transform: translateY(1px);}
.key.small{font-size:13px; font-weight:800; color:rgba(246,241,232,.75)}
.key.danger{color:rgba(255,200,200,.92)}
.key.ok{color:rgba(225,255,225,.92)}

/* tiny text */
.hint{margin-top:10px; color:var(--muted2); font-size:13px; line-height:1.55}
.error{margin-top:10px; color:rgba(255,185,185,.95); font-size:13px; line-height:1.45}
.smallrow{display:flex; justify-content:space-between; gap:10px; margin-top:12px; flex-wrap:wrap}
.badge{
  display:inline-flex; gap:8px; align-items:center;
  padding:8px 10px;
  border:1px solid rgba(255,255,255,.12);
  border-radius:999px;
  color:rgba(246,241,232,.72);
  font-size:12px;
  background: rgba(0,0,0,.18);
}

/* door open overlay + subtle shake on wrong pwd */
.overlay{
  position:absolute; inset:0;
  pointer-events:none;
  opacity:0;
  transition: opacity .35s ease;
  background: radial-gradient(800px 500px at 50% 30%, rgba(0,0,0,.0), rgba(0,0,0,.55) 70%, rgba(0,0,0,.75) 100%);
}
.openAnim .overlay{opacity:1}

@keyframes shake{
  0%,100%{transform:translateX(0)}
  20%{transform:translateX(-6px)}
  40%{transform:translateX(6px)}
  60%{transform:translateX(-4px)}
  80%{transform:translateX(4px)}
}
.shake{animation: shake .28s ease;}

.fade{opacity:0; transform:translateY(6px); transition: all .45s ease;}
.show{opacity:1; transform:translateY(0);}

/* welcome section */
.welcome{
  padding:10px 22px 22px 22px;
}
.big{
  font-size:28px;
  font-weight:1000;
  letter-spacing:.6px;
  margin:0 0 8px 0;
}
.soft{color:var(--muted); margin:0; line-height:1.75; font-size:14px}
.hr{height:1px; background:rgba(255,255,255,.14); margin:14px 0}
</style>
</head>

<body>
<div class="wrap">
  <div class="doorCard" id="card">
    <div class="doorFrame"></div>
    <div class="overlay"></div>

    <div class="plaque">
      <span class="tag"><span class="dot"></span>这是大门口</span>

      <div class="nameplate">
        <span class="plateTop">我和你的家</span>
        <span class="plateSub">welcome home</span>
      </div>
    </div>

    <button class="knocker" id="knocker" type="button" aria-label="猫爪门环：敲门">
      <span class="paw" aria-hidden="true">
        <span class="toe t1"></span>
        <span class="toe t2"></span>
        <span class="toe t3"></span>
        <span class="toe t4"></span>
        <span class="pad"></span>
      </span>
      <span class="ring" aria-hidden="true"></span>
    </button>

    <div class="ding" id="ding" aria-hidden="true">叮咚～</div>


    <!-- BEFORE WELCOME: scene with door + lock -->
   <div class="inner" id="pre">
      <div>
        <h1 id="title">敲敲门</h1>
        <p class="sub" id="subtitle">第一次来，请为我们家设置一个密码！以后每次回来就用这个密码啦～</p>

        <div id="welcomeTease" class="hint" style="margin-top:10px;">
          老婆辛苦啦～快来一起休息吧！
        </div>
      </div>

      <div class="lock">
        <div class="lockHeader">
          <div class="lockTitle">Door Lock</div>
          <div class="brass"></div>
        </div>

        <!-- SETUP -->
        <div id="setup" class="fade">
          <div class="displayRow">
            <input id="newPwd" type="password" inputmode="numeric" placeholder="设置密码（建议4-8位）" autocomplete="new-password" />
          </div>
          <div class="displayRow" style="margin-top:10px;">
            <input id="newPwd2" type="password" inputmode="numeric" placeholder="再输入一次" autocomplete="new-password" />
            <button class="primary" id="btnSet">设置</button>
          </div>

          <div class="keypad" aria-label="keypad-setup">
            <button class="key" data-k="1" type="button">1</button>
            <button class="key" data-k="2" type="button">2</button>
            <button class="key" data-k="3" type="button">3</button>
            <button class="key" data-k="4" type="button">4</button>
            <button class="key" data-k="5" type="button">5</button>
            <button class="key" data-k="6" type="button">6</button>
            <button class="key" data-k="7" type="button">7</button>
            <button class="key" data-k="8" type="button">8</button>
            <button class="key" data-k="9" type="button">9</button>
            <button class="key small danger" data-action="clr" type="button">清空</button>
            <button class="key" data-k="0" type="button">0</button>
            <button class="key small ok" data-action="swap" type="button">换输入框</button>
          </div>

          <div class="hint">密码只会保存在你设备本地。如果你换了设备，需要重新设置一次。</div>
          <div class="error" id="setupErr" style="display:none;"></div>
        </div>

        <!-- LOGIN -->
        <div id="login" class="fade" style="display:none;">
          <div class="displayRow">
            <input id="pwd" type="password" inputmode="numeric" placeholder="输入密码" autocomplete="current-password" />
            <button class="primary" id="btnGo">开门</button>
          </div>

          <div class="keypad" aria-label="keypad-login">
            <button class="key" data-k="1" type="button">1</button>
            <button class="key" data-k="2" type="button">2</button>
            <button class="key" data-k="3" type="button">3</button>
            <button class="key" data-k="4" type="button">4</button>
            <button class="key" data-k="5" type="button">5</button>
            <button class="key" data-k="6" type="button">6</button>
            <button class="key" data-k="7" type="button">7</button>
            <button class="key" data-k="8" type="button">8</button>
            <button class="key" data-k="9" type="button">9</button>
            <button class="key small danger" data-action="del" type="button">退格</button>
            <button class="key" data-k="0" type="button">0</button>
            <button class="key small ok" data-action="go" type="button">确认</button>
          </div>

          <div class="hint" id="loginHint">慢慢来，不着急。</div>
          <div class="error" id="loginErr" style="display:none;"></div>

          <div class="smallrow">
            <button class="ghost" id="btnReset" type="button">重新设置密码</button>
            <span class="badge"><span class="dot"></span><span id="statusText">门锁已启用</span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- WELCOME -->
    <div id="welcome" class="welcome fade" style="display:none;">
      <p class="big">欢迎回家！</p>
      <p class="soft">我在 ❤️</p>
      <div class="hr"></div>
      <p class="soft">（3 秒后带你进屋）</p>
    </div>
  </div>
</div>

<script>
// ====== 配置 ======
const HOME_URL = "./home/";
// =====================================================

// 简单 hash（仪式感门锁，不是强安全）
async function sha256(str){
  const data = new TextEncoder().encode(str);
  const hash = await crypto.subtle.digest("SHA-256", data);
  return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,"0")).join("");
}

const KEY_HASH = "welcomehome_pwd_hash_v1";

const el = (id)=>document.getElementById(id);
const card = el("card");

const setup = el("setup");
const login = el("login");
const welcome = el("welcome");
const pre = el("pre");

const setupErr = el("setupErr");
const loginErr = el("loginErr");

function modeSetup(){
  el("title").textContent = "第一次来";
  el("subtitle").textContent = "请为我们家设置一个密码！以后每次回来就用这个密码啦～";

  pre.style.display = "";            // ✅显示门口界面
  login.style.display = "none";
  welcome.style.display = "none";

  setup.style.display = "";
  setup.classList.remove("show");
  requestAnimationFrame(()=>setup.classList.add("show"));
}

function modeLogin(){
  el("title").textContent = "敲敲门";
  el("subtitle").textContent = "输入密码，开门。";

  pre.style.display = "";
  setup.style.display = "none";
  welcome.style.display = "none";

  login.style.display = "";
  login.classList.remove("show");
  requestAnimationFrame(()=>login.classList.add("show"));
  el("pwd").focus();
}

function modeWelcome(){
  setup.style.display = "none";
  login.style.display = "none";

  pre.style.display = "none";
  welcome.style.display = "";
  welcome.classList.remove("show");
  requestAnimationFrame(()=>welcome.classList.add("show"));
}


async function init(){
  const hash = localStorage.getItem(KEY_HASH);
  if(!hash){
    modeSetup();
  }else{
    modeLogin();
  }
}

// ====== keypad helper ======
let activeSetupField = "newPwd"; // swap between newPwd / newPwd2

function appendTo(id, ch){
  const x = el(id);
  x.value = (x.value || "") + ch;
  x.focus();
}
function delFrom(id){
  const x = el(id);
  x.value = (x.value || "").slice(0, -1);
  x.focus();
}
function clearField(id){
  const x = el(id);
  x.value = "";
  x.focus();
}

function bindKeypad(containerId, mode){
  const container = el(containerId);
  if(!container) return;
  container.addEventListener("click", (e)=>{
    const btn = e.target.closest("button");
    if(!btn) return;
    const k = btn.dataset.k;
    const action = btn.dataset.action;

    if(mode === "setup"){
      const targetId = activeSetupField;
      if(k != null) appendTo(targetId, k);
      if(action === "clr"){ clearField("newPwd"); clearField("newPwd2"); activeSetupField = "newPwd"; }
      if(action === "swap"){ activeSetupField = (activeSetupField === "newPwd") ? "newPwd2" : "newPwd"; el(activeSetupField).focus(); }
    }

    if(mode === "login"){
      if(k != null) appendTo("pwd", k);
      if(action === "del") delFrom("pwd");
      if(action === "go") el("btnGo").click();
    }
  });
}

// bind both keypads (we used the same class structure, so just bind by querying parents)
bindKeypad("setup", "setup");
bindKeypad("login", "login");

// ====== actions ======
el("btnSet").addEventListener("click", async ()=>{
  setupErr.style.display = "none";
  const a = el("newPwd").value.trim();
  const b = el("newPwd2").value.trim();

  if(a.length < 4 || a.length > 32){
    setupErr.textContent = "密码建议 4–8 位（最多 32 位也可以）。";
    setupErr.style.display = "";
    return;
  }
  if(a !== b){
    setupErr.textContent = "两次输入不一致，再试一次。";
    setupErr.style.display = "";
    return;
  }
  const h = await sha256(a);
  localStorage.setItem(KEY_HASH, h);

  el("newPwd").value = "";
  el("newPwd2").value = "";
  activeSetupField = "newPwd";

  modeLogin();
});

el("btnGo").addEventListener("click", async ()=>{
  loginErr.style.display = "none";
  const input = el("pwd").value.trim();
  if(!input){
    loginErr.textContent = "先输入密码哦。";
    loginErr.style.display = "";
    card.classList.remove("shake");
    void card.offsetWidth;
    card.classList.add("shake");
    return;
  }
  const inputHash = await sha256(input);
  const saved = localStorage.getItem(KEY_HASH);

  if(inputHash !== saved){
    loginErr.textContent = "密码不对❌没关系，再试一次吧。";
    loginErr.style.display = "";
    el("pwd").select();
    card.classList.remove("shake");
    void card.offsetWidth;
    card.classList.add("shake");
    return;
  }

  // success
  el("pwd").value = "";
  card.classList.add("openAnim");
  modeWelcome();

  setTimeout(()=>{ window.location.href = HOME_URL; }, 3000);
});

el("pwd")?.addEventListener("keydown", (e)=>{
  if(e.key === "Enter") el("btnGo").click();
});

el("btnReset").addEventListener("click", ()=>{
  localStorage.removeItem(KEY_HASH);
  card.classList.remove("openAnim");
  modeSetup();
});

init();
const knocker = document.getElementById("knocker");
const ding = document.getElementById("ding");

knocker?.addEventListener("click", ()=>{
  ding.classList.add("show");
  setTimeout(()=>ding.classList.remove("show"), 650);


  knocker.classList.remove("knock");
  void knocker.offsetWidth;
  knocker.classList.add("knock");

  const sub = document.querySelector(".plateSub");
if(sub){
  const old = sub.textContent;
  sub.textContent = "someone's home ✨";
  setTimeout(()=>{ sub.textContent = old; }, 900);
}
});

</script>
</body>
</html>
